<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>INVEST ‚Äî Finances perso & PEA/CTO/Crypto</title>
<meta name="theme-color" content="#0b1220" />
<style>
:root{--bg:#0b1220;--bg2:#0a1020;--text:#eef2ff;--muted:#9aa3bb;--card:rgba(255,255,255,.06);--border:rgba(255,255,255,.15)}
@media (prefers-color-scheme: light){body.theme-auto{--bg:#f5f7ff;--bg2:#ecf2ff;--text:#0c1327;--muted:#60729b;--card:rgba(0,0,0,.04);--border:rgba(0,0,0,.12)}}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
a{color:inherit;text-decoration:none}
.glass{background:var(--card);border:1px solid var(--border);backdrop-filter:blur(10px);border-radius:18px;box-shadow:0 8px 28px rgba(0,0,0,.2)}
.app{max-width:1100px;margin:40px auto 20px;padding:0 16px}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.logo{display:flex;gap:10px;align-items:center}
.logo-badge{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#2333a9,#4a8df0);display:flex;align-items:center;justify-content:center;font-weight:800}
.nav{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0;padding:10px}
.nav a{padding:10px 12px;border:1px solid var(--border);border-radius:999px}
.nav a.active{background:linear-gradient(90deg,#1a2250,#0f1530);border-color:#2a3770}
.view{padding:12px}
.card{padding:14px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
.muted{color:var(--muted)}
.table-wrap{overflow:auto;border:1px solid var(--border);border-radius:14px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px;border-bottom:1px solid var(--border);text-align:left;white-space:nowrap}
.form{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin:10px 0}
.metric{background:var(--card);border:1px dashed var(--border);border-radius:12px;padding:10px}
.metric .label{font-size:12px;color:var(--muted)}
.metric .val{font-weight:800;font-size:20px}
canvas{max-width:100%}
</style>
</head>
<body class="theme-auto">
<div class="app">
  <header class="topbar">
    <div class="logo">
      <div class="logo-badge">‚Ç¨</div>
      <div>
        <div style="font-weight:800">INVEST</div>
        <div class="muted" style="font-size:12px">SPA locale (inline)</div>
      </div>
    </div>
    <select id="theme">
      <option value="auto" selected>Th√®me: Auto</option>
      <option value="dark">Sombre</option>
      <option value="light">Clair</option>
    </select>
  </header>

  <nav class="nav glass">
    <a href="#/dashboard" class="navlink active">üìä Dashboard</a>
    <a href="#/transactions" class="navlink">üí∏ Transactions</a>
    <a href="#/budgets" class="navlink">üì¶ Budgets</a>
    <a href="#/invest" class="navlink">üìà Invest</a>
    <a href="#/goals" class="navlink">üéØ Objectifs</a>
    <a href="#/analysis" class="navlink">üß† Analyses</a>
    <a href="#/io" class="navlink">‚¨ÜÔ∏è‚¨áÔ∏è Import/Export</a>
    <a href="#/settings" class="navlink">‚öôÔ∏è Param√®tres</a>
  </nav>

  <main id="view" class="view glass"></main>
</div>

<script>
(function(){
'use strict';
function qs(s,r){return (r||document).querySelector(s)}
function qsa(s,r){return Array.from((r||document).querySelectorAll(s))}
function cur(n,c){try{return new Intl.NumberFormat('fr-FR',{style:'currency',currency:c||'EUR'}).format(+n||0)}catch(e){return '‚Ç¨'+(+n||0)}}

const state = { settings:{ theme:'auto', currency:'EUR' }, transactions:[], budgets:[], holds:[], dca:[], goals:[] };

// THEME
function applyTheme(){ const t=state.settings.theme||'auto';
  document.body.classList.remove('theme-auto','theme-dark','theme-light');
  document.body.classList.add('theme-'+t);
  const sel=qs('#theme'); if(sel) sel.value=t;
}
qs('#theme').addEventListener('change', e => { state.settings.theme=e.target.value; applyTheme(); });

// ROUTER
const routes = {};
function route(path, render){ routes[path]=render; }
function nav(){
  const path = location.hash.replace('#','') || '#/dashboard';
  qsa('.navlink').forEach(a => a.classList.toggle('active', a.getAttribute('href')===path));
  (routes[path] || routes['#/dashboard'])();
}
window.addEventListener('hashchange', nav);

// VIEWS (minimales mais r√©elles)
function viewDashboard(){
  qs('#view').innerHTML = `
  <section class="grid">
    <div class="card">
      <h3>Vue rapide</h3>
      <div class="grid">
        <div class="metric"><div class="label">Capital total</div><div class="val" id="k_total">‚Ç¨0</div></div>
        <div class="metric"><div class="label">Variation du mois</div><div class="val" id="k_var">‚Ç¨0</div></div>
        <div class="metric"><div class="label">Taux d‚Äô√©pargne</div><div class="val" id="k_save">0%</div></div>
      </div>
      <p class="muted">Ajoute quelques transactions pour voir les chiffres bouger.</p>
    </div>
    <div class="card"><h3>D√©penses par cat√©gorie (mois)</h3><canvas id="bar" width="700" height="260"></canvas></div>
    <div class="card"><h3>Flux 12 mois</h3><canvas id="line" width="900" height="260"></canvas></div>
  </section>`;
  renderDashboard();
}
function viewTx(){
  qs('#view').innerHTML = `
  <section class="card">
    <h3>Transactions</h3>
    <form id="txf" class="form">
      <label>Type
        <select id="tt"><option value="income">Revenu</option><option value="expense">D√©pense</option><option value="invest">Investissement</option></select>
      </label>
      <label>Date <input type="date" id="td"></label>
      <label>Compte
        <select id="ta"><option>Banque</option><option>PEA</option><option>CTO</option><option>Crypto</option></select>
      </label>
      <label>Cat√©gorie <input id="tc" placeholder="Courses, Logement..." /></label>
      <label>Description <input id="te" placeholder="Note" /></label>
      <label>Montant (‚Ç¨) <input id="tm" type="number" step="0.01" /></label>
      <button class="glass" style="padding:10px 12px;border-radius:10px">Ajouter</button>
    </form>
    <div class="table-wrap"><table class="table"><thead><tr>
      <th>Date</th><th>Type</th><th>Compte</th><th>Cat√©gorie</th><th>Description</th><th>Montant</th>
    </tr></thead><tbody id="tb"></tbody></table></div>
  </section>`;
  const f = qs('#txf');
  try{ qs('#td').valueAsDate = new Date(); }catch(e){}
  f.addEventListener('submit', (e)=>{
    e.preventDefault();
    const t={date:qs('#td').value,type:qs('#tt').value,account:qs('#ta').value,category:qs('#tc').value||'(NC)',desc:qs('#te').value||'',amount:+(qs('#tm').value||0)};
    if(!t.date || !t.amount){ alert('Date et montant requis'); return; }
    state.transactions.unshift(t);
    renderTx();
  });
  renderTx();
}
function viewBdg(){ qs('#view').innerHTML = `<section class="card"><h3>Budgets</h3><p class="muted">√Ä venir (on garde simple pour relancer l‚Äôappli).</p></section>`; }
function viewInv(){ qs('#view').innerHTML = `<section class="card"><h3>Invest</h3><p class="muted">√Ä venir (PEA/CTO/Crypto, presets) ‚Äî on valide d‚Äôabord les onglets.</p></section>`; }
function viewGoals(){ qs('#view').innerHTML = `<section class="card"><h3>Objectifs</h3><p class="muted">√Ä venir ‚Äî on remettra la progression apr√®s validation.</p></section>`; }
function viewAnalysis(){ qs('#view').innerHTML = `<section class="card"><h3>Analyses</h3><p class="muted">√Ä venir ‚Äî ratios & alertes apr√®s validation.</p></section>`; }
function viewIO(){ qs('#view').innerHTML = `<section class="card"><h3>Import / Export</h3><p class="muted">√Ä venir ‚Äî garder simple pour relancer vite.</p></section>`; }
function viewSet(){
  qs('#view').innerHTML = `<section class="card"><h3>Param√®tres</h3>
    <label>Th√®me
      <select id="theme2"><option value="auto">Auto</option><option value="dark">Sombre</option><option value="light">Clair</option></select>
    </label>
  </section>`;
  const s=qs('#theme2'); s.value=state.settings.theme; s.onchange=()=>{ state.settings.theme=s.value; applyTheme(); };
}

// RENDERERS
function renderTx(){
  const tb = qs('#tb'); tb.innerHTML='';
  state.transactions.forEach(t=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${t.date}</td><td>${t.type}</td><td>${t.account}</td><td>${t.category}</td><td>${t.desc}</td><td>${cur(t.amount,state.settings.currency)}</td>`;
    tb.appendChild(tr);
  });
  renderDashboard(); // met √† jour les m√©triques
}
function renderDashboard(){
  const now=new Date(), y=now.getFullYear(), m=now.getMonth();
  const month=state.transactions.filter(t=>{const d=new Date(t.date);return d.getFullYear()===y&&d.getMonth()===m;});
  let inc=0,exp=0,inv=0;
  month.forEach(t=>{ if(t.type==='income') inc+=+t.amount; else if(t.type==='expense') exp+=Math.abs(+t.amount); else if(t.type==='invest') inv+=Math.abs(+t.amount); });
  let global=0;
  state.transactions.forEach(t=>{ if(t.type==='income') global+=+t.amount; else if(t.type==='expense'||t.type==='invest') global-=Math.abs(+t.amount); });
  const k_total=qs('#k_total'), k_var=qs('#k_var'), k_save=qs('#k_save');
  if(k_total) k_total.textContent = cur(global);
  if(k_var)   k_var.textContent   = cur(inc-exp-inv);
  if(k_save)  k_save.textContent  = inc? (((inc-exp-inv)/Math.max(1,inc))*100).toFixed(1)+'%':'0%';

  // mini-graphiques (placeholder sans d√©pendances)
  const bar=qs('#bar'); if(bar){ const x=bar.getContext('2d'); x.clearRect(0,0,bar.width,bar.height); x.fillStyle='#9aa3bb'; x.fillText('Graph barres (placeholder)',10,20); }
  const line=qs('#line'); if(line){ const x=line.getContext('2d'); x.clearRect(0,0,line.width,line.height); x.fillStyle='#9aa3bb'; x.fillText('Courbe 12 mois (placeholder)',10,20); }
}

// INIT
function init(){
  applyTheme();
  route('#/dashboard',viewDashboard);
  route('#/transactions',viewTx);
  route('#/budgets',viewBdg);
  route('#/invest',viewInv);
  route('#/goals',viewGoals);
  route('#/analysis',viewAnalysis);
  route('#/io',viewIO);
  route('#/settings',viewSet);
  if(!location.hash) location.hash = '#/dashboard';
  nav();
}
document.readyState==='loading' ? document.addEventListener('DOMContentLoaded',init) : init();
})();
</script>
</body>
</html>
